<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
   <meta http-equiv="content-type" content="text/html; charset=windows-1250">
   <meta name="generator" content="PSPad editor, www.pspad.com">
   <link rel="stylesheet" type="text/css" href="../style.css">
   <title>36PAA - ulohy (Michal Trs)</title>
</head>
<body>
   <h1>36PAA - Batoh �e�en� metodou simulovan� ochlazov�n� (pokro�il� iterativn� metoda)</h1>

   <div id="main">
      <h2>Zad�n�</h2>
         <ul>
            <li>Zvolte si heuristiku, kterou budete �e�it probl�m v�en� splnitelnosti booleovsk� formule (simulovan� ochlazov�n�, simulovan� evoluce, tabu prohled�v�n�)</li>
            <li>Tuto heuristiku pou�ijte pro �e�en� probl�mu batohu. M��ete pou��t dostupn� instance probl�mu (<a href="http://service.felk.cvut.cz/courses/36PAA/knapsolv.html">zde</a>), anebo si vygenerujte sv� instance pomoc� <a href="http://service.felk.cvut.cz/courses/36PAA/wknapgen.html">gener�toru</a>. Pou��vejte instance s v�t��m po�tem v�c� (>30).</li>
            <li>Hlavn�m c�lem dom�c� pr�ce je sezn�mit se s danou heuristikou, zejm�na se zp�sobem, jak�m se nastavuj� jej� parametry (rozvrh ochlazov�n�, selek�n� tlak, tabu lh�ta...) a modifikace (zji�t�n� po��te�n� teploty, mechanismus selekce, tabu atributy...). Nen�-li V�m cokoli jasn�, pros�me ptejte se na cvi�en�ch.</li>
            <li>Probl�m batohu nen� p��li� obt�n�, v�t�inou budete m�t k dispozici glob�ln� maxima (exaktn� �e�en�) z p�edchoz�ch prac�, nap��klad z dynamick�ho programov�n�.</li>
         </ul>

      <h2>Implementace</h2>
         <p>
         Z pokro�il�ch iterativn�ch metod jsem si vybral algoritmus simulovan� ochlazov�n�. Je pops�n "v�vojov�mi diagramy" na n�sleduj�c�ch obr�zc�ch.
         </p>

         <table><tr>
            <td><img src="algoritmus/simanel.png"/></td>
            <td><img src="algoritmus/try.png"/></td>
         </tr></table>
         
         Pokus�m se algoritmus popsat slovn�. Jedn� se o 2 vno�en� cykly. Na za��tku je nastaveno n�jak� �e�en� a po��te�n� teplota, kter� se ve venkovn�m cyklu postupn� sni�uje. Teplotou je d�na ochota algoritmu p�ijmout hor�� �e�en�. T�m se m��e algoritmus vymanit z lok�ln�ho minima. Ve vnit�n�m cyklu se hled� nov� �e�en�. To je pops�no na obr�zku jako funkce "try". N�hodn� vygenerujeme nov� p��pustn� �e�en�. Pokud je lep�� ne� doposud nalezen�, toto �e�en� p�ijmeme. Pokud je hor�� tak jej p�ijmeme s ur�itou pravd�podobnost�, kter� je d�na aktu�ln� teplotou a velikost� zhor�en� ceny. Algoritmus kon�� pokud se teplota sn�� na �rove� teploty tuhnut�. Pro spr�vnou funkci algoritmu je velice d�le�it� nastavit parametry (po��te�n� teplota, teplota tuhnut�, rychlost tuhnut�, velikost equilibria).
         
         <h3>Zdrojov� k�dy</h3>
            <ul>
               <li><a href="source/SimAnneal.cs">SimAnneal.cs</a> - Implementace algoritmu simulovan�ho ochlazov�n�</li>
               <li><a href="source/Batoh-SimAnneal.zip">Batoh-SimAnneal.zip</a></li> - K�d z minul�ch �loh pou�it pro testov�n� (Greedy Proof, Dynamick� programov�n�)
            </ul>
               

      <h2>Nam��en� hodnoty a v�sledky</h2>
         <p>
            Aby bylo mo�n� spr�vn� nastavit parametry algoritmu je nutn� experimentovat. P�i experimentech jsem sledoval �asovou n�ro�nost a relativn� chybu. Pro v�po�et glob�ln�ho maxima (pro v�po�et relativn� chyby) jsem pou�il d��ve implementovan� <a href="../batoh2/">dynamick� programov�n�</a>. Algoritmus jsem srovn�val s Greedy Proof (metodou nejrychlej��ho vzestupu). Experimenty jsou shrnuty v n�sleduj�c�ch tabulk�ch a grafech.<br/>
            Pro p�ehlednost jsem pou�il tyto zkratky:
         </p>
         <p><code>
            SA = Simulated Annealing = simulovan� ochlazov�n�<br/>
            GP = Greedy Proof = metoda nejrychlej��ho vzestupu<br/>
            triv = pou�ito trivi�ln� �e�en� pro inicializaci SA<br/>
            init GP = pou�ito GA pro inicializaci SA<br/>
            T0 = po��te�n� teplota<br/>
            Tf = teplota tuhnut�<br/>
            dT = zm�na teploty<br/>
            equ = equilibrium<br/>
         </code></p>
         
         <p>Pokud nen� uvedeno jinak, experimentoval jsem na instanc�ch o velikosti n = 40. SA bylo na ka�d� instanci spu�t�no 20x a v�sledn� relativn� chyba a �as je pr�m�r z v�sled� algoritmu.</p>
         <p>M��il jsem na NTB s procesorem Centino 1.4GHz, nastaven� max Performance p�i nap�jen� z adapt�ru. Pou�it� OS: Windows XP SP2 s .net Framework 2.</p>



         
      <h3>Nastaven� zm�ny teploty</h3>
      
      P�i tomto experimentu jsem nastavil T0 = (M * suma_cen_veci) / (n * suma_vah_veci), Tf = 10, equ = n a m�nil dT v rozmez� 0,8 - 0,999.
      
      <table>
         <tr><th rowspan="2">dT</th><th colspan="3">relativn� chyba</th><th colspan="3">�as</th></tr>
         <tr><th>GP</th><th>SA triv</th><th>SA init GP</th><th>GP</th><th>SA triv</th><th>SA init GP</th></tr>
         <tr><td>0,999</td><td rowspan="8">0,15%</td><td>0,12%</td><td>0,02%</td><td rowspan="8">0,0625</td><td>278,731</td><td>642,995</td></tr>
         <tr><td>0,995</td><td>0,42%</td><td>0,07%</td><td>58,154</td><td>128,795</td></tr>
         <tr><td>0,99</td><td>0,64%</td><td>0,09%</td><td>27,17</td><td>66,054</td></tr>
         <tr><td>0,98</td><td>1,14%</td><td>0,12%</td><td>13,159</td><td>32,717</td></tr>
         <tr><td>0,975</td><td>1,29%</td><td>0,13%</td><td>10,525</td><td>24,725</td></tr>
         <tr><td>0,95</td><td>2,01%</td><td>0,14%</td><td>5,358</td><td>12,509</td></tr>
         <tr><td>0,9</td><td>3,26%</td><td>0,14%</td><td>2,644</td><td>6,039</td></tr>
         <tr><td>0,8</td><td>5,50%</td><td>0,15%</td><td>1,271</td><td>2,944</td></tr>
      </table>

      <h4>Graf: Z�vislost relativn� chyby na zm�n� rychlosti ochlazov�n�</h4>
      <p><img src="grafy/err_dt.png"/></p>
      
      <h4>Graf: Z�vislost �asov� slo�itosti na zm�n� rychlosti ochlazov�n�</h4>
      <p><img src="grafy/cas_dt.png"/></p>

      
      <h3>Nastaven� velikosti equilibria</h3>

      Nastaven�: T0 = (M * suma_cen_veci) / (n * suma_vah_veci), Tf = 10, dT = 0,9 a 0,98, m�nil jsem equ v intervalu n / 5 a� n * 5

      <table>
         <tr><th rowspan="3">equ</th><th colspan="5">relativn� chyba</th><th colspan="5">�as</th></tr>
         <tr><th rowspan="2">GP</th><th colspan="2">SA triv</th><th colspan="2">SA init GP</th><th rowspan="2">GP</th><th colspan="2">SA triv</th><th colspan="2">SA init GP</th></tr>
         <tr><th>dT = 0,98</th><th>dT = 0,9</th><th>dT = 0,98</th><th>dT = 0,9</th><th>dT = 0,98</th><th>dT = 0,9</th><th>dT = 0,98</th><th>dT = 0,9</th></tr>
         <tr><td>200</td><td rowspan="9">0,15%</td><td>0,34%</td><td>1,16%</td><td>0,07%</td><td>0,12%</td><td rowspan="9">0,0625</td><td>65,663</td><td>13,23</td><td>153,191</td><td>30,184</td></tr>
         <tr><td>160</td><td>0,39%</td><td>1,31%</td><td>0,07%</td><td>0,13%</td><td>54,198</td><td>10,345</td><td>123,097</td><td>23,945</td></tr>
         <tr><td>120</td><td>0,52%</td><td>1,53%</td><td>0,09%</td><td>0,13%</td><td>39,346</td><td>7,922</td><td>92,753</td><td>17,866</td></tr>
         <tr><td>80</td><td>0,72%</td><td>2,06%</td><td>0,10%</td><td>0,14%</td><td>26,067</td><td>5,438</td><td>61,899</td><td>11,907</td></tr>
         <tr><td>40</td><td>1,13%</td><td>3,20%</td><td>0,12%</td><td>0,15%</td><td>13,149</td><td>2,664</td><td>30,694</td><td>5,988</td></tr>
         <tr><td>20</td><td>1,76%</td><td>5,85%</td><td>0,13%</td><td>0,14%</td><td>6,84</td><td>1,332</td><td>15,35</td><td>3,074</td></tr>
         <tr><td>13</td><td>2,26%</td><td>8,18%</td><td>0,14%</td><td>0,15%</td><td>4,376</td><td>0,981</td><td>10,385</td><td>2,013</td></tr>
         <tr><td>10</td><td>2,83%</td><td>10,06%</td><td>0,14%</td><td>0,15%</td><td>3,435</td><td>0,701</td><td>7,771</td><td>1,652</td></tr>
         <tr><td>8</td><td>3,45%</td><td>12,09%</td><td>0,15%</td><td>0,15%</td><td>2,724</td><td>0,581</td><td>6,239</td><td>1,312</td></tr>
      </table>
      
      <h4>Graf: Z�vislost relativn� chyby na velikosti equilibria</h4>
      <p><img src="grafy/err_equ.png"/></p>

      <h4>Graf: Z�vislost �asov� slo�itosti na velikosti equilibria</h4>
      <p><img src="grafy/cas_equ.png"/></p>


      <h3>Nastaven� teploty tuhnut�</h3>

      Nastaven�: T0 = (M * suma_cen_veci) / (n * suma_vah_veci), dT = 0,98, equ = n, m�nil jsem Tf v intervalu 1 a� 10.

      <table>
         <tr><th rowspan="2">Tf</th><th colspan="3">relativn� chyba</th><th colspan="3">�as</th></tr>
         <tr><th>GP</th><th>SA triv</th><th>SA init GP</th><th>GP</th><th>SA triv</th><th>SA init GP</th></tr>
         <tr><td>1</td><td rowspan="6">0,15%</td><td>0,94%</td><td>0,12%</td><td rowspan="6">0,0625</td><td>27,539</td><td>30,604</td></tr>
         <tr><td>2</td><td>0,94%</td><td>0,12%</td><td>23,254</td><td>25,857</td></tr>
         <tr><td>3</td><td>0,99%</td><td>0,12%</td><td>20,659</td><td>22,893</td></tr>
         <tr><td>5</td><td>0,96%</td><td>0,12%</td><td>17,325</td><td>18,837</td></tr>
         <tr><td>7</td><td>0,99%</td><td>0,12%</td><td>15,433</td><td>17,745</td></tr>
         <tr><td>10</td><td>1,08%</td><td>0,13%</td><td>13,229</td><td>14,521</td></tr>
      </table>

      <h4>Graf: Z�vislost relativn� chyby na teplot� tuhnut�</h4>
      <p><img src="grafy/err_tf.png"/></p>

      <h4>Graf: Z�vislost �asov� slo�itosti na teplot� tuhnut�</h4>
      <p><img src="grafy/cas_tf.png"/></p>


      <h3>Nastaven� po��te�n� teploty</h3>
      
      Nastaven�: Tf = 1, dT = 0,98, equ = n, m�nil jsem T0 v intervalu 35 a� 200
      
      <table>
         <tr><th rowspan="2">T0</th><th colspan="3">relativn� chyba</th><th colspan="3">�as</th></tr>
         <tr><th>GP</th><th>SA triv</th><th>SA init GP</th><th>GP</th><th>SA triv</th><th>SA init GP</th></tr>
         <tr><td>200</td><td rowspan="10">0,15%</td><td>0,98%</td><td>0,12%</td><td rowspan="10">0,0625</td><td>32,928</td><td>34,81</td></tr>
         <tr><td>150</td><td>0,95%</td><td>0,12%</td><td>32,247</td><td>32,547</td></tr>
         <tr><td>100</td><td>0,92%</td><td>0,12%</td><td>28,632</td><td>32,676</td></tr>
         <tr><td>80</td><td>1,01%</td><td>0,12%</td><td>28,491</td><td>34,389</td></tr>
         <tr><td>60</td><td>1,11%</td><td>0,12%</td><td>25,667</td><td>32,868</td></tr>
         <tr><td>50</td><td>1,23%</td><td>0,12%</td><td>24,735</td><td>30,273</td></tr>
         <tr><td>45</td><td>1,37%</td><td>0,12%</td><td>23,764</td><td>30,454</td></tr>
         <tr><td>40</td><td>1,71%</td><td>0,12%</td><td>23,153</td><td>28,821</td></tr>
         <tr><td>37</td><td>1,98%</td><td>0,12%</td><td>22,693</td><td>27,059</td></tr>
         <tr><td>35</td><td>2,25%</td><td>0,12%</td><td>22,381</td><td>27,239</td></tr>
      </table>

      <h4>Graf: Z�vislost relativn� chyby na po��te�n� teplot�</h4>
      <p><img src="grafy/err_t0.png"/></p>

      <h4>Graf: Z�vislost �asov� slo�itosti na po��te�n� teplot�</h4>
      <p><img src="grafy/cas_t0.png"/></p>


      <h3>Z�vislost relativn� chyby na velikosti instance</h3>
      Jen tak pro zaj�mavost, srovn�n� pr�m�rn� relativn� chyby pro r�zn� velk� instance.
      Nastaven� parametr�: dT = 0,98, Tf = 5, equ = n, T0 = 67,31
      
      <h4>Graf: Z�vislost relativn� chyby na velikosti instance</h4>
      <p><img src="grafy/err_n.png"/></p>

      
      <h2>Uk�zky pr�chodu algoritmu stavov�m prostorem</h2>
      Na n�sleduj�c�ch grafech je zobrazena velikost ceny v z�vislosti na prozkouman�ch stavech pro r�zn� parametry. Pro zv�t�en� klikn�te na pros�m na graf.
      

      <table>
         <tr>
            <td>init GP, dT = 0,8, Tf = 5, equ = n, T0 = 67,31</td>
            <td>triv, dT = 0,8, Tf = 5, equ = n, T0 = 67,31</td>
         </tr>
         <tr>
            <td><a target="_blank" class="lightbox" href="grafy/gp_080_5_n.png"><img src="grafy/small/gp_080_5_n.png"/></a></td>
            <td><a target="_blank" class="lightbox" href="grafy/sam_080_5_n.png"><img src="grafy/small/sam_080_5_n.png"/></a></td>
            
         </tr>
         <tr>
            <td>init GP, dT = 0,9, Tf = 5, equ = n, T0 = 67,31</td>
               <td>triv, dT = 0,9, Tf = 5, equ = n, T0 = 67,31</td>
         </tr>
         <tr>
            <td><a target="_blank" class="lightbox" href="grafy/gp_090_5_n.png"><img src="grafy/small/gp_090_5_n.png"/></a></td>
            <td><a target="_blank" class="lightbox" href="grafy/sam_090_5_n.png"><img src="grafy/small/sam_090_5_n.png"/></a></td>
         </tr>
         <tr>
            <td>init GP, dT = 0,98, Tf = 5, equ = n, T0 = 67,31</td>
            <td>triv, dT = 0,98, Tf = 5, equ = n, T0 = 67,31</td>
         </tr>
         <tr>
            <td><a target="_blank" class="lightbox" href="grafy/gp_098_5_n.png"><img src="grafy/small/gp_098_5_n.png"/></a></td>
            <td><a target="_blank" class="lightbox" href="grafy/sam_098_5_n.png"><img src="grafy/small/sam_098_5_n.png"/></a></td>
         </tr>
         <tr>
            <td>init GP, dT = 0,98, Tf = 5, equ = n / 5, T0 = 67,31</td>
            <td>init GP, dT = 0,98, Tf = 5, equ = 5 * n, T0 = 67,31</td>
         </tr>
         <tr>
            <td><a target="_blank" class="lightbox" href="grafy/gp_098_5_n5.png"><img src="grafy/small/gp_098_5_n5.png"/></a></td>
            <td><a target="_blank" class="lightbox" href="grafy/gp_098_5_5n.png"><img src="grafy/small/gp_098_5_5n.png"/></a></td>
         </tr>
      </table>
      


      <h2>Z�v�r</h2>
         Algoritmus simulovan� ochlazov�n� je pom�rn� snadn� na implementaci. Z experiment� m��eme ��ct, �e je �asov� n�ro�n�j�� ne� hladov� algoritmus a p�i inicializaci trivi�ln� konfiguraci d�v� pr�m�rn� hor�� v�sledky. Pokud inicializujeme SA hodnotou z�skanou GP algoritmem, v pr�m�ru v�dy dojde ke zlep�en� relativn� chyby. Proto�e algoritmus si pomatuje nejlep�� �e�en�, nem��e nikdy vyj�t hor�� v�sledek ne� u GP.<br/>
         U tohoto algoritmu (stejn� jako u dynamick�ho programov�n�) dop�edu zn�me po�et iterac� cyklu, tud� m��eme odhadnout �asovou n�ro�nost. Proto je na prvn� pohled trochu divn�, ��dov� rozd�ln� �as p�i inicializaci trivi�ln�m �e�en�m a �e�en�m dodan�m GP algoritmem. Skryt� �asov� z�vislost je v generov�n� nov�ho stavu. Ten generujeme tak, �e zm�n�me bit na n�hodn� pozici v sou�asn� konfiguraci, ale v�sledn� konfigurace mus� b�t p��pustn�m �e�en�m. Proto pokud vyjdeme z trivi�ln� konfigurace je velk� pravd�podobnost, �e nov� stav vygenerujeme na 1. pokus. U ji� nalezen�ho �e�en� nap�. algoritmem GP opakujeme generov�n� pom�rn� dlouho, ne� dostaneme p��pustnou konfiguraci.<br/>
         D�le z proveden�ch experiment� m��eme ud�lat tyto z�v�ry:
         <ul>
         <li>��m bl�e dT k 1 t�m men�� relativn� chyba, ale v�t�� �asov� n�ro�nost.</li>
         <li>Po��te�n� teplotu je vhodn� volit jako funkci velikosti instance. V experimentu d�v� nejlep�� v�sledky n * 2. Na dostuduj jsem na�el tento vztah: M * suma(ceny) / (N * suma(v�hy)), kter� d�v� podobn� v�sledky.</li>
         <li>Teplotu tuhnut� je nejlep�� "vykoukat" z graf� pro z�vislost ceny na po�tu prozkouman�ch stav�. Pokud se cena nem�n�, m�lo by doj�t k zamrazen�. To m��eme p��mo o�et�it v programu a nemus�me tento parametr nastavovat.</li>
         <li>Velikost equilibria, ��m v�t�� t�m men�� relativn� chyba, ale v�t�� �asov� n�ro�nost.</li>
         </ul>


   </div>


<script src="/archive/lightbox.js"></script>
</body>
</html>
