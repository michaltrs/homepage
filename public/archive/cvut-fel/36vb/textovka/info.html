<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="cs">
<head>
	<meta http-equiv="content-type" content="text/html; charset=windows-1250">
	<title>Dokumentace k TXT game</title>
</head>

<body>
<center><h1>TXT game</h1></center><hr size="2" width="90%">

<h2>Popis aplikace</h2>

Jedná se o textovou RPG hru. Její pøíbìh je zasazen do blíže nespecifikovaného svìta skøetù, trpaslíkù a jiných potvor. Historické období není urèeno, proto se ve høe mùžete setkat s neèekanými vìcmi.<br> Soubojový systém, jak jsem zjistil, je v podstatì pøevzat z Draèího doupìte. Postava má charakterizující vlastnosti: SÍLA, ODOLNOST, ÚTOK a OBRANA. Útoèné èíslo se poèítá SÍLA + 0..ÚTOK, pøièemž když padne 0 je kritický neúspìch, to znamená že váš / potvory útok se v tomto kole ruší. Obrané èíslo se poèítá jako ODOLNOST + 0..OBRANA. Když je útoèné èíslo vìtší než obrané èíslo, tak vaše postava/potvora pøijde o životy odpovídající rozdílu útoèného a obraného èísla. Všechny vlastnosti vašeho hrdiny mùžete zlepšit / zhoršit pomocí rùzných meèù, štítù, brnìní a lektvarù.
<br><br>
Na této mapì se odehrává pøíbìh:<br>
<img src="DokData/mapa.png" width="638" height="528" alt="" border="0">

 
<h2>Popis instalace</h2> 

Staèí rozbalit zip archív vèetnì podadresáøù do vámi vybraného adresáøe 


<h2>Návod ke spuštìní a ovládání</h2> 

<h3>Spuštìní</h3>
V pøíkazovém øádku MS-DOS spustit soubor <b>TXTgame.exe</b> z adresáøe, kam jste hru rozbalili.<br>
V prostøedí Windows poklepání na ikonku <b>TXTgame</b>

<h3>Ovládání</h3>
 
 Ovládání hry pøipomíná pøíkazový øádek MS-DOS,
 u pøíkazù a parametrù se nerozlišují malá a VELKÁ písmena. 
 <h4>Seznam všech pøíkazù:</h4>

<table border="1">
<tr><th>Popis èinnosti</th><th>Pøíkaz</th><th>Parametr</th><th>Kde se musí daná vìc na kterou je pøíkaz použit nacházet</th></tr>

<tr>
       <td>chùze do další lokace</td>
       <td>jdi, bez, g</td>
	   <td>jméno dveøi</td>
	   <td>další místnost</td>
</tr>
<tr>
       <td>zvednuti predmetu do invetare</td>
       <td>seber, zvedni, t</td>
	   <td>jméno pøedmìtu</td>
	   <td>místnost</td>
</tr>
<tr>
       <td>zahozeni predmetu na zem</td>
       <td>zahod, poloz, p</td>
	   <td>jméno pøedmìtu</td>
	   <td>prava ruka, leva ruka, telo, inventar</td>
</tr>
<tr>
       <td>prohlednuti predmetu</td>
       <td>zkoumat, ukaz, e</td>
	   <td>jméno pøedmìtu</td>
	   <td>mistnost</td>
</tr>
<tr>
       <td>utok na potvoru</td>
       <td>zabij, utok, a</td>
	   <td>jméno potvory</td>
	   <td>mistnost</td>
</tr>
<tr>
       <td>zkoumani lokace</td>
       <td>koukam, l</td>
	   <td>-----</td>
	   <td>souèasná místnost</td>
</tr>
<tr>
       <td>ukazani vlastnosti postavy</td>
       <td>char, c</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
<tr>
       <td>ukazani inventare</td>
       <td>inv, i</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
<tr>
       <td>uchopeni predmetu z inventare</td>
       <td>leva, prava, telo</td>
	   <td>jméno pøedmìtu</td>
	   <td>inventáø</td>
</tr>
<tr>
       <td>pouziti predmetu z inventare</td>
       <td>pouzij, use, u</td>
	   <td>jméno pøedmìtu</td>
	   <td>inventáø</td>
</tr>
<tr>
       <td>konec hry</td>
       <td>konec</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
</table>

<br>
 
 Pøíklad: JDI veznice, ZABIJ skret, INV, CHAR<br>
 Poznámka: Je jedno, jestli použijete pøíkaz JDI nebo G, mají úplnì stejnou funkci. To platí u všech ostatních pøíkazù.<br>
 
                    
<h2>Popis øešení</h2>
<h4>Popis hrubého øešení programu</h4>
Procedura LoadWorld pomocí dalších procedur a funkcí naète xml soubor a vytvoøí z nìj datovou strukturu.
Tata datová struktura je tvoøena lineárním seznamem místností, který je ještì navíc provázán dalšími ukazateli, které pøedstavují jednotlivé dveøe do dalších místností. Každá místnost obsahuje další 2 lineární seznamy: seznam potvor a seznam pøedmìtù. Každá potvora mùže obsahovat další pøedmìty.
Datová struktura tohoto svìta vypadá takto:
<img src="DokData/datastr.png" width="800" height="600" border="0">

<br><br> 
Hráè je reprezentován záznamem, ve kterém je definována jeho síla,obrana, to co má na sobì, dále ukazatel na inventáø, což je seznam itemù a ukazatel na aktuální místnost. <br>
Vlastní hra funguje tak, že v cyklu se nejprve volá procedura <b>CheckAtckCr</b>, která zjistí jestli na vaši postavu útoèí první postova v místnosti. Pokud ano tato procedura zavolá proceduru <b>souboj</b>. Jako další volá proceduru <b>CtiVstup</b>, která vám pokládá otázku: <i>"Co chces delat?"</i> a vrací hodnotu pøíkazu a parametru. Pøíkaz a parametr jsou poslány do další procedury <b>DoAction</b>, která si v pøevodní tabulce z unity MeziTab zjistí, jaká konstanta odpovídá pøíkazu. Tato konstanta je selektor vìtvení, který urèuje, jaká procedura se zavolá. Pokud žádná procedura neodpovídá konstantì, což znamená, že pøíkaz je chybný, vypíše se chybová hláška. Vìdšinì tìmto procedurám se posílá parametr (string), vìdšinou jméno potvory nebo pøedmìtu. Tento cyklus konèí pokud životy vaší postavy (curLive) jsou menší než 0, nebo promìná run je false. Promìná run se zmìní na false v pøípadì, že zabitá potvora, sebraný pøedmìt nebo místnost do která jste pøišli má promìnou endg = true.  <br>

Celý program je rozdìlen do 5 unit a hlavního programu. V unitì <b>datastr</b> jsou naimlementovány 3 lineární seznamy, procedury a funkce pro práci s nimi a zásobník. Zásobník se používá pouze v proceduøe LoadWorld pro ukládání ukazatelù na poslední místnost/potvoru/pøedmìt. <br><br><br>
Výpis typù, promìných, lavièek procedur a funkcí v unitì <b>DataStr</b>:<br>

<h4>Zásobník</h4>

<b>procedure Init (var Zasobnik: UkPolozka);</b><br>
inicializace zásobníku, nastavení vrcholu a dna na nil<br><br>
<b>function Empty (Zasobnik: UkPolozka): boolean;</b><br>
pokud je zásobník prázdný vrací true<br><br>
<b>function Push (t: zTyp; m: UkRoom; c:UkCreature; i:UkItem; var Vrchol: UkPolozka):boolean;</b><br>
pøidání do zásobíku<br>
Protože jsem v Pascalu nepøišel na zpùsob jak pøetypovat typovaný ukazatel, musí se do parametru t zadat o který ukazatel se jedná, ten pak pøiøadit správnému parametru a zbylé nastavit na nil (není nutné). <br><br>
<b>function Pop (var Vrchol: UkPolozka):pointer;</b><br>
odebere prvek ze zásobníku, s prvkem se již dál nepracuje, proto je ukazatel netypový
<br><br>
<h4>Práce s místnostmi</h4>
<b>procedure rLoadDoors(s: string; var dl: tDoorList);</b><br>
Naplní pole Doors v aktuální místnosti jménami místností kam se dá jít<br><br>
<b>function rNew (at: AttList; n: byte; p: pTab): UkRoom;</b><br>
Vytvoøí záznam odpovídající nové místnosti a vrátí na ní ukazatel, parametry které nebyly v XML souboru zadány nastaví na poèáteèní hodnotu<br><br>
<b>procedure rAdd ( nova: UkRoom; var world: UkRoom);</b><br>
Pøidá (novou) místnost na zaèátek lineárního seznamu kam ukazuje promìná world<br><br>
<b>function rSearch (jmeno: string; svet: UkRoom): UkRoom;</b><br>
Vrátí adresu odpovídající jménu místnosti v parametru jmeno<br><br>
<b>procedure rInitDoors(var svet: UkRoom);</b><br>
volá se po naètení celého svìta, pro každé dveøe ve všech místnostech zavolá prceduru rSearch a výslednou adresu uloží do pole dveøí Doors ke jménu dveøí<br><br> 
<b>function rSearchDoor(d: string; m: UkRoom): UkRoom;</b><br>
podle jmena d najde odpovídající adresu místnosti, funkce navenek je stejná jako u rSearch, ale prohledává pouze konkrétní místnost, Rychlé!!!<br><br>

<h4>Práce s pøedmìty</h4>

<b>function iNew(Atrib: AttList;n: byte; p:pTab): UkItem;</b><br>
Pomocí Atrib listu z funkce gettag a prevodní tabulky vytvoøí záznam pøedmìt a vrátí na nìj ukazetel<br>
<br><b>function iSearch (jmeno: string; predmet: UkItem): UkItem;</b><br>
 Najde adresu pøedmìtu odpovídajíci jménu v seznamu na který ukazuje pøedmìt<br>
<br><b>procedure iAdd (novy: UkItem; var kam: UkItem);</b><br>
Pøidá novy na zaèátek seznamu kam ukazuje kam<br>
<br><b>procedure iAddToEnd (novy: UkItem; var iList: UkItem);</b><br>
Vhodné pro pøidávání celého seznamu k jinému. POMALÉ!!!<br>
<br><b>function iRemove (predmet: UkItem; var ItemList: UkItem): UkItem;</b><br>
Odebere pøedmìt z itemlistu a vrátí jeho adresu<br>
<br><b>procedure iMove (var i, odkud, kam: UkItem);</b><br>
pøesune pøedmìt mezi dvìmi seznami<br><br>
<h4>Práce s potvorami</h4>
<br><b>function cNew(Atrib: AttList;n: byte; p:pTab): UkCreature;</b><br>
 viz iNew<br>
<br><b>procedure cAdd (nova: UkCreature; var kam: UkCreature);</b><br>
viz iAdd<br>
<br><b>function cRemove (potvora: UkCreature; var cList: UkCreature): UkCreature;</b><br>
vir iRemove<br>
<br><b>function cSearch (jmeno: string; potvora: UkCreature): UkCreature;</b><br>
viz i Search<br>
<br><br><br><br>
V unitì <b>MeziTab</b> jsou dvì pøevodní tabulky sloužící pro pøevod øetìzce na èíselnou konstantu. Jsou zde deklarovány 2 sady konstant. Jedna sada slouží pøi vytváøení datové struktury ze souboru, ve funkcích rNew, iNew, cNew. Druhá sada slouží jako dekodér pøíkazù z pøíkazového øádku. Kaødá tabulka se musí zvlášt inicializovat. K tomu slouží procedure InitTabVstup(var T: pTab); a procedure InitTabPar(var T: pTab);<br>
Pøevod je realizován funkcí function Preved(T: pTab; k: string): byte;<br><br><br>

Unita <b>barvy</b> se mela starat o vsechny vystupy na obrazovku. Jsou v ni pouze procedury na zmìnu barvy, aby se v programu nemuselo vypisovat napø.: textcolor(yellow) s procedury s parametrem string. Tyto procedury obsahují pouze zmìnu barvy a standartní proceduru write/writeln<br><br><br>

Unita <b>infoFile</b> obsahuje pouze informativní text s popisem ovládání<br><br><br>

Unita <b>Parser</b> - obsahuje tyto funkce:<br><br>
<b>function openFile (var f: text; name: string): boolean;</b><br>
funkce na otevøení textového souboru f se jménem name, vrací true pokud otevøení probìhlo úspìšnì<br><br>
<b>function UpString(s: string): string;</b><br>
Velice využívaná funkce. Pøevede každý znak z øetìzce string na velké písmeno a znak opìt vrátí do øetìzce. Napø.: aHoj --) AHOJ<br><br>
<b>function getTag(var f:text;var name: string;var fl: byte;var n: byte;var att: Attlist;var count:string):boolean;</b><br>
Vlastní funkce na parsrování XML souboru. Naète vždy jeden tag a vrátí true pokud naètení probìhlo v poøádku. Používá další funkce, ale ty pro výsledné øešení nemají další význam. V promìných jsou tyto data:<br><b>name</b> - jmeno tagu<br><b>fl</b> - STARTTAG/ENDTAG/SINGLETAG<br><b>n</b> - pocet atributù<br><b>att</b> - pole od 1 do MAXATT záznamù 2 øetìzcù: name a value<br><b>count </b>- text pøed tagem<br><br><br>

Vlastní program obsahuje funkci <b>Loadworld(f:text):UkRoom</b> Která vytvoøí celou datovou strukturu místností / potvor / pøedmìtù. Dále procedury pro vytvoøení hlavní (Vaší) postavy a prácí s ní (pøidávání / ubírání vìcí do / z inventáøe, používání pøedmìtù,...). Dále jsou zde procedury rVypis, iVypis, cVypis pro vypisovani vlastnosti. Dùležitá je procedura souboj. Je to kompletní soubojový systém s výpisem prùbìhu a následným pøendáním vypadlých pøedmìtù. Po skonèení hry se volají procedury CloseWorld, která uvolòuje pamìt místností / potvor / pøedmìtù a procedura freeHero, ktera uvolni dynamicky alokovane promene u hrdiny (inventáø). Procedury tvoøící celé komunikaèní rozhraní s hráèem jsou <b>CtiVstup(var typ, hod: string);</b> a <b>DoAction (t,hod: string);</b> volané v tomto poøadí. Pro inicializaci celé hry je nutné zavolat proceduru <b>initGame</b> na kterou navazuje procedura <b>menu</b>.<br><br><br>


<div align="right">Pro pøípadné další otázky pište na <a href=mailto:mtrs@seznam.cz>email</a></div>

</body>
</html>
