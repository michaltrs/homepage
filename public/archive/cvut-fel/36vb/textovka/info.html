<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="cs">
<head>
	<meta http-equiv="content-type" content="text/html; charset=windows-1250">
	<title>Dokumentace k TXT game</title>
</head>

<body>
<center><h1>TXT game</h1></center><hr size="2" width="90%">

<h2>Popis aplikace</h2>

Jedn� se o textovou RPG hru. Jej� p��b�h je zasazen do bl�e nespecifikovan�ho sv�ta sk�et�, trpasl�k� a jin�ch potvor. Historick� obdob� nen� ur�eno, proto se ve h�e m��ete setkat s ne�ekan�mi v�cmi.<br> Soubojov� syst�m, jak jsem zjistil, je v podstat� p�evzat z Dra��ho doup�te. Postava m� charakterizuj�c� vlastnosti: S�LA, ODOLNOST, �TOK a OBRANA. �to�n� ��slo se po��t� S�LA + 0..�TOK, p�i�em� kdy� padne 0 je kritick� ne�sp�ch, to znamen� �e v� / potvory �tok se v tomto kole ru��. Obran� ��slo se po��t� jako ODOLNOST + 0..OBRANA. Kdy� je �to�n� ��slo v�t�� ne� obran� ��slo, tak va�e postava/potvora p�ijde o �ivoty odpov�daj�c� rozd�lu �to�n�ho a obran�ho ��sla. V�echny vlastnosti va�eho hrdiny m��ete zlep�it / zhor�it pomoc� r�zn�ch me��, �t�t�, brn�n� a lektvar�.
<br><br>
Na t�to map� se odehr�v� p��b�h:<br>
<img src="DokData/mapa.png" width="638" height="528" alt="" border="0">

 
<h2>Popis instalace</h2> 

Sta�� rozbalit zip arch�v v�etn� podadres��� do v�mi vybran�ho adres��e 


<h2>N�vod ke spu�t�n� a ovl�d�n�</h2> 

<h3>Spu�t�n�</h3>
V p��kazov�m ��dku MS-DOS spustit soubor <b>TXTgame.exe</b> z adres��e, kam jste hru rozbalili.<br>
V prost�ed� Windows poklep�n� na ikonku <b>TXTgame</b>

<h3>Ovl�d�n�</h3>
 
 Ovl�d�n� hry p�ipom�n� p��kazov� ��dek MS-DOS,
 u p��kaz� a parametr� se nerozli�uj� mal� a VELK� p�smena. 
 <h4>Seznam v�ech p��kaz�:</h4>

<table border="1">
<tr><th>Popis �innosti</th><th>P��kaz</th><th>Parametr</th><th>Kde se mus� dan� v�c na kterou je p��kaz pou�it nach�zet</th></tr>

<tr>
       <td>ch�ze do dal�� lokace</td>
       <td>jdi, bez, g</td>
	   <td>jm�no dve�i</td>
	   <td>dal�� m�stnost</td>
</tr>
<tr>
       <td>zvednuti predmetu do invetare</td>
       <td>seber, zvedni, t</td>
	   <td>jm�no p�edm�tu</td>
	   <td>m�stnost</td>
</tr>
<tr>
       <td>zahozeni predmetu na zem</td>
       <td>zahod, poloz, p</td>
	   <td>jm�no p�edm�tu</td>
	   <td>prava ruka, leva ruka, telo, inventar</td>
</tr>
<tr>
       <td>prohlednuti predmetu</td>
       <td>zkoumat, ukaz, e</td>
	   <td>jm�no p�edm�tu</td>
	   <td>mistnost</td>
</tr>
<tr>
       <td>utok na potvoru</td>
       <td>zabij, utok, a</td>
	   <td>jm�no potvory</td>
	   <td>mistnost</td>
</tr>
<tr>
       <td>zkoumani lokace</td>
       <td>koukam, l</td>
	   <td>-----</td>
	   <td>sou�asn� m�stnost</td>
</tr>
<tr>
       <td>ukazani vlastnosti postavy</td>
       <td>char, c</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
<tr>
       <td>ukazani inventare</td>
       <td>inv, i</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
<tr>
       <td>uchopeni predmetu z inventare</td>
       <td>leva, prava, telo</td>
	   <td>jm�no p�edm�tu</td>
	   <td>invent��</td>
</tr>
<tr>
       <td>pouziti predmetu z inventare</td>
       <td>pouzij, use, u</td>
	   <td>jm�no p�edm�tu</td>
	   <td>invent��</td>
</tr>
<tr>
       <td>konec hry</td>
       <td>konec</td>
	   <td>-----</td>
	   <td>-----</td>
</tr>
</table>

<br>
 
 P��klad: JDI veznice, ZABIJ skret, INV, CHAR<br>
 Pozn�mka: Je jedno, jestli pou�ijete p��kaz JDI nebo G, maj� �pln� stejnou funkci. To plat� u v�ech ostatn�ch p��kaz�.<br>
 
                    
<h2>Popis �e�en�</h2>
<h4>Popis hrub�ho �e�en� programu</h4>
Procedura LoadWorld pomoc� dal��ch procedur a funkc� na�te xml soubor a vytvo�� z n�j datovou strukturu.
Tata datov� struktura je tvo�ena line�rn�m seznamem m�stnost�, kter� je je�t� nav�c prov�z�n dal��mi ukazateli, kter� p�edstavuj� jednotliv� dve�e do dal��ch m�stnost�. Ka�d� m�stnost obsahuje dal�� 2 line�rn� seznamy: seznam potvor a seznam p�edm�t�. Ka�d� potvora m��e obsahovat dal�� p�edm�ty.
Datov� struktura tohoto sv�ta vypad� takto:
<img src="DokData/datastr.png" width="800" height="600" border="0">

<br><br> 
Hr�� je reprezentov�n z�znamem, ve kter�m je definov�na jeho s�la,obrana, to co m� na sob�, d�le ukazatel na invent��, co� je seznam item� a ukazatel na aktu�ln� m�stnost. <br>
Vlastn� hra funguje tak, �e v cyklu se nejprve vol� procedura <b>CheckAtckCr</b>, kter� zjist� jestli na va�i postavu �to�� prvn� postova v m�stnosti. Pokud ano tato procedura zavol� proceduru <b>souboj</b>. Jako dal�� vol� proceduru <b>CtiVstup</b>, kter� v�m pokl�d� ot�zku: <i>"Co chces delat?"</i> a vrac� hodnotu p��kazu a parametru. P��kaz a parametr jsou posl�ny do dal�� procedury <b>DoAction</b>, kter� si v p�evodn� tabulce z unity MeziTab zjist�, jak� konstanta odpov�d� p��kazu. Tato konstanta je selektor v�tven�, kter� ur�uje, jak� procedura se zavol�. Pokud ��dn� procedura neodpov�d� konstant�, co� znamen�, �e p��kaz je chybn�, vyp�e se chybov� hl�ka. V�d�in� t�mto procedur�m se pos�l� parametr (string), v�d�inou jm�no potvory nebo p�edm�tu. Tento cyklus kon�� pokud �ivoty va�� postavy (curLive) jsou men�� ne� 0, nebo prom�n� run je false. Prom�n� run se zm�n� na false v p��pad�, �e zabit� potvora, sebran� p�edm�t nebo m�stnost do kter� jste p�i�li m� prom�nou endg = true.  <br>

Cel� program je rozd�len do 5 unit a hlavn�ho programu. V unit� <b>datastr</b> jsou naimlementov�ny 3 line�rn� seznamy, procedury a funkce pro pr�ci s nimi a z�sobn�k. Z�sobn�k se pou��v� pouze v procedu�e LoadWorld pro ukl�d�n� ukazatel� na posledn� m�stnost/potvoru/p�edm�t. <br><br><br>
V�pis typ�, prom�n�ch, lavi�ek procedur a funkc� v unit� <b>DataStr</b>:<br>

<h4>Z�sobn�k</h4>

<b>procedure Init (var Zasobnik: UkPolozka);</b><br>
inicializace z�sobn�ku, nastaven� vrcholu a dna na nil<br><br>
<b>function Empty (Zasobnik: UkPolozka): boolean;</b><br>
pokud je z�sobn�k pr�zdn� vrac� true<br><br>
<b>function Push (t: zTyp; m: UkRoom; c:UkCreature; i:UkItem; var Vrchol: UkPolozka):boolean;</b><br>
p�id�n� do z�sob�ku<br>
Proto�e jsem v Pascalu nep�i�el na zp�sob jak p�etypovat typovan� ukazatel, mus� se do parametru t zadat o kter� ukazatel se jedn�, ten pak p�i�adit spr�vn�mu parametru a zbyl� nastavit na nil (nen� nutn�). <br><br>
<b>function Pop (var Vrchol: UkPolozka):pointer;</b><br>
odebere prvek ze z�sobn�ku, s prvkem se ji� d�l nepracuje, proto je ukazatel netypov�
<br><br>
<h4>Pr�ce s m�stnostmi</h4>
<b>procedure rLoadDoors(s: string; var dl: tDoorList);</b><br>
Napln� pole Doors v aktu�ln� m�stnosti jm�nami m�stnost� kam se d� j�t<br><br>
<b>function rNew (at: AttList; n: byte; p: pTab): UkRoom;</b><br>
Vytvo�� z�znam odpov�daj�c� nov� m�stnosti a vr�t� na n� ukazatel, parametry kter� nebyly v XML souboru zad�ny nastav� na po��te�n� hodnotu<br><br>
<b>procedure rAdd ( nova: UkRoom; var world: UkRoom);</b><br>
P�id� (novou) m�stnost na za��tek line�rn�ho seznamu kam ukazuje prom�n� world<br><br>
<b>function rSearch (jmeno: string; svet: UkRoom): UkRoom;</b><br>
Vr�t� adresu odpov�daj�c� jm�nu m�stnosti v parametru jmeno<br><br>
<b>procedure rInitDoors(var svet: UkRoom);</b><br>
vol� se po na�ten� cel�ho sv�ta, pro ka�d� dve�e ve v�ech m�stnostech zavol� prceduru rSearch a v�slednou adresu ulo�� do pole dve�� Doors ke jm�nu dve��<br><br> 
<b>function rSearchDoor(d: string; m: UkRoom): UkRoom;</b><br>
podle jmena d najde odpov�daj�c� adresu m�stnosti, funkce navenek je stejn� jako u rSearch, ale prohled�v� pouze konkr�tn� m�stnost, Rychl�!!!<br><br>

<h4>Pr�ce s p�edm�ty</h4>

<b>function iNew(Atrib: AttList;n: byte; p:pTab): UkItem;</b><br>
Pomoc� Atrib listu z funkce gettag a prevodn� tabulky vytvo�� z�znam p�edm�t a vr�t� na n�j ukazetel<br>
<br><b>function iSearch (jmeno: string; predmet: UkItem): UkItem;</b><br>
 Najde adresu p�edm�tu odpov�daj�ci jm�nu v seznamu na kter� ukazuje p�edm�t<br>
<br><b>procedure iAdd (novy: UkItem; var kam: UkItem);</b><br>
P�id� novy na za��tek seznamu kam ukazuje kam<br>
<br><b>procedure iAddToEnd (novy: UkItem; var iList: UkItem);</b><br>
Vhodn� pro p�id�v�n� cel�ho seznamu k jin�mu. POMAL�!!!<br>
<br><b>function iRemove (predmet: UkItem; var ItemList: UkItem): UkItem;</b><br>
Odebere p�edm�t z itemlistu a vr�t� jeho adresu<br>
<br><b>procedure iMove (var i, odkud, kam: UkItem);</b><br>
p�esune p�edm�t mezi dv�mi seznami<br><br>
<h4>Pr�ce s potvorami</h4>
<br><b>function cNew(Atrib: AttList;n: byte; p:pTab): UkCreature;</b><br>
 viz iNew<br>
<br><b>procedure cAdd (nova: UkCreature; var kam: UkCreature);</b><br>
viz iAdd<br>
<br><b>function cRemove (potvora: UkCreature; var cList: UkCreature): UkCreature;</b><br>
vir iRemove<br>
<br><b>function cSearch (jmeno: string; potvora: UkCreature): UkCreature;</b><br>
viz i Search<br>
<br><br><br><br>
V unit� <b>MeziTab</b> jsou dv� p�evodn� tabulky slou��c� pro p�evod �et�zce na ��selnou konstantu. Jsou zde deklarov�ny 2 sady konstant. Jedna sada slou�� p�i vytv��en� datov� struktury ze souboru, ve funkc�ch rNew, iNew, cNew. Druh� sada slou�� jako dekod�r p��kaz� z p��kazov�ho ��dku. Ka�d� tabulka se mus� zvl�t inicializovat. K tomu slou�� procedure InitTabVstup(var T: pTab); a procedure InitTabPar(var T: pTab);<br>
P�evod je realizov�n funkc� function Preved(T: pTab; k: string): byte;<br><br><br>

Unita <b>barvy</b> se mela starat o vsechny vystupy na obrazovku. Jsou v ni pouze procedury na zm�nu barvy, aby se v programu nemuselo vypisovat nap�.: textcolor(yellow) s procedury s parametrem string. Tyto procedury obsahuj� pouze zm�nu barvy a standartn� proceduru write/writeln<br><br><br>

Unita <b>infoFile</b> obsahuje pouze informativn� text s popisem ovl�d�n�<br><br><br>

Unita <b>Parser</b> - obsahuje tyto funkce:<br><br>
<b>function openFile (var f: text; name: string): boolean;</b><br>
funkce na otev�en� textov�ho souboru f se jm�nem name, vrac� true pokud otev�en� prob�hlo �sp�n�<br><br>
<b>function UpString(s: string): string;</b><br>
Velice vyu��van� funkce. P�evede ka�d� znak z �et�zce string na velk� p�smeno a znak op�t vr�t� do �et�zce. Nap�.: aHoj --) AHOJ<br><br>
<b>function getTag(var f:text;var name: string;var fl: byte;var n: byte;var att: Attlist;var count:string):boolean;</b><br>
Vlastn� funkce na parsrov�n� XML souboru. Na�te v�dy jeden tag a vr�t� true pokud na�ten� prob�hlo v po��dku. Pou��v� dal�� funkce, ale ty pro v�sledn� �e�en� nemaj� dal�� v�znam. V prom�n�ch jsou tyto data:<br><b>name</b> - jmeno tagu<br><b>fl</b> - STARTTAG/ENDTAG/SINGLETAG<br><b>n</b> - pocet atribut�<br><b>att</b> - pole od 1 do MAXATT z�znam� 2 �et�zc�: name a value<br><b>count </b>- text p�ed tagem<br><br><br>

Vlastn� program obsahuje funkci <b>Loadworld(f:text):UkRoom</b> Kter� vytvo�� celou datovou strukturu m�stnost� / potvor / p�edm�t�. D�le procedury pro vytvo�en� hlavn� (Va��) postavy a pr�c� s n� (p�id�v�n� / ub�r�n� v�c� do / z invent��e, pou��v�n� p�edm�t�,...). D�le jsou zde procedury rVypis, iVypis, cVypis pro vypisovani vlastnosti. D�le�it� je procedura souboj. Je to kompletn� soubojov� syst�m s v�pisem pr�b�hu a n�sledn�m p�end�n�m vypadl�ch p�edm�t�. Po skon�en� hry se volaj� procedury CloseWorld, kter� uvol�uje pam�t m�stnost� / potvor / p�edm�t� a procedura freeHero, ktera uvolni dynamicky alokovane promene u hrdiny (invent��). Procedury tvo��c� cel� komunika�n� rozhran� s hr��em jsou <b>CtiVstup(var typ, hod: string);</b> a <b>DoAction (t,hod: string);</b> volan� v tomto po�ad�. Pro inicializaci cel� hry je nutn� zavolat proceduru <b>initGame</b> na kterou navazuje procedura <b>menu</b>.<br><br><br>


<div align="right">Pro p��padn� dal�� ot�zky pi�te na <a href=mailto:mtrs@seznam.cz>email</a></div>

<script src="/archive/lightbox.js"></script>
</body>
</html>
